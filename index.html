<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>متجر المعرفة للمنتجات الرقمية</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">
    <!-- Swiper's CSS -->
    <link rel="stylesheet" href="https://unpkg.com/swiper/swiper-bundle.min.css"/>
    <!-- Lucide Icons Library -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        body {
            font-family: 'Cairo', sans-serif;
            background-color: #0c1427;
            color: #e0e0e0;
        }
        .hero-bg {
            background-image: linear-gradient(rgba(12, 20, 39, 0.8), rgba(12, 20, 39, 1)), url('https://placehold.co/1200x600/0a192f/e0e0e0?text=اكتشف+عالم+المعرفة');
            background-size: cover;
            background-position: center;
        }
        .card {
            background-color: #1a2942;
            transition: transform 0.3s, box-shadow 0.3s;
        }
        .card:hover {
            transform: translateY(-10px);
            box-shadow: 0 20px 25px -5px rgba(251, 191, 36, 0.1), 0 10px 10px -5px rgba(251, 191, 36, 0.04);
        }
        .btn-primary {
            background-color: #fbbf24;
            color: #1a2942;
            transition: background-color 0.3s;
        }
        .btn-primary:hover {
            background-color: #f59e0b;
        }
        .btn-secondary {
             background-color: transparent;
             color: #fbbf24;
             border: 1px solid #fbbf24;
             transition: background-color 0.3s, color 0.3s;
        }
        .btn-secondary:hover {
            background-color: #fbbf24;
            color: #1a2942;
        }
        .page-content {
            display: none; /* Hide all pages by default */
        }
        #home.page-content {
            display: block; /* Show home page by default */
        }
        .nav-link.active {
            color: #fbbf24;
            font-weight: bold;
        }
        .swiper-container {
            width: 100%;
            height: 50vh;
            max-height: 450px;
            border-radius: 1rem;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }
        .swiper-slide img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.6);
            backdrop-filter: blur(5px);
        }
        .modal-content {
            background-color: #1a2942;
            margin: 10% auto;
            padding: 2rem;
            border-radius: 1rem;
            width: 90%;
            max-width: 600px;
            color: #e0e0e0;
        }
        .cart-item img {
            width: 60px;
            height: 60px;
            object-fit: cover;
            border-radius: 0.5rem;
        }
        .contact-card {
            background-color: #1a2942;
            transition: transform 0.3s, box-shadow 0.3s;
        }
        .contact-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px -3px rgba(251, 191, 36, 0.1), 0 4px 6px -2px rgba(251, 191, 36, 0.05);
        }
    </style>
</head>
<body>

    <!-- Header -->
    <header class="bg-gray-900/50 backdrop-blur-sm sticky top-0 z-50 relative">
        <div class="container mx-auto px-6 py-4 flex justify-between items-center">
            <a href="#" data-page="home" class="text-xl md:text-2xl font-bold text-white flex items-center">
                <i data-lucide="lightbulb" class="ml-3 text-amber-400"></i>
                <div>
                    <span class="text-amber-400">متجر</span> المعرفة
                    <span class="block text-sm font-normal text-gray-400 md:inline">للمنتجات الرقمية</span>
                </div>
            </a>
            <nav id="main-nav" class="hidden md:flex space-x-8 space-x-reverse text-lg">
                <a href="#" data-page="home" class="nav-link active hover:text-amber-400 transition-colors">الرئيسية</a>
                <a href="#" data-page="products" class="nav-link hover:text-amber-400 transition-colors">المنتجات</a>
                <a href="#" data-page="about" class="nav-link hover:text-amber-400 transition-colors">حولنا</a>
                <a href="#" data-page="contact" class="nav-link hover:text-amber-400 transition-colors">اتصل بنا</a>
            </nav>
            <div class="flex items-center">
                <button id="cart-button" class="ml-4 relative text-white hover:text-amber-400 transition-colors">
                    <i data-lucide="shopping-cart"></i>
                    <span id="cart-counter" class="absolute -top-2 -right-2 bg-red-600 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center">0</span>
                </button>
                 <button id="mobile-menu-button" class="md:hidden text-white">
                    <i data-lucide="menu"></i>
                </button>
            </div>
        </div>
        <!-- Mobile Menu -->
        <div id="mobile-menu" class="hidden md:hidden bg-gray-900/80 backdrop-blur-sm absolute top-full right-0 left-0">
            <a href="#" data-page="home" class="nav-link-mobile block py-3 px-6 text-white hover:bg-amber-400/20 transition-colors">الرئيسية</a>
            <a href="#" data-page="products" class="nav-link-mobile block py-3 px-6 text-white hover:bg-amber-400/20 transition-colors">المنتجات</a>
            <a href="#" data-page="about" class="nav-link-mobile block py-3 px-6 text-white hover:bg-amber-400/20 transition-colors">حولنا</a>
            <a href="#" data-page="contact" class="nav-link-mobile block py-3 px-6 text-white hover:bg-amber-400/20 transition-colors">اتصل بنا</a>
        </div>
    </header>

    <main>
        <!-- Home Page Wrapper -->
        <div id="home" class="page-content">
            <section class="hero-bg text-white">
                <div class="container mx-auto px-6 py-24 md:py-32 text-center">
                    <h2 class="text-4xl md:text-6xl font-bold mb-4 leading-tight">بوابتك إلى عالم من الإلهام</h2>
                    <p class="text-xl md:text-2xl mb-8 max-w-3xl mx-auto">منتجات فريدة تشعل فضولك وتضيء أفكارك.</p>
                    <a href="#" id="browse-products-btn" data-page="products" class="btn-primary font-bold py-3 px-8 rounded-lg text-lg">تصفح المنتجات</a>
                </div>
            </section>
            <section class="py-16 bg-0c1427">
                <div class="container mx-auto px-6">
                    <h3 class="text-3xl font-bold text-center mb-10 text-amber-400">نافذة على عالم المعرفة</h3>
                    <div class="swiper-container">
                        <div class="swiper-wrapper">
                            <div class="swiper-slide"><img src="https://images.pexels.com/photos/3184418/pexels-photo-3184418.jpeg?auto=compress&cs=tinysrgb&w=1260&h=750&dpr=1" alt="فريق عمل يناقش أفكاراً"></div>
                            <div class="swiper-slide"><img src="https://images.pexels.com/photos/4145190/pexels-photo-4145190.jpeg?auto=compress&cs=tinysrgb&w=1260&h=750&dpr=1" alt="سيدة تعمل على لابتوب في مكان هادئ"></div>
                            <div class="swiper-slide"><img src="https://images.pexels.com/photos/159711/books-bookstore-book-reading-159711.jpeg?auto=compress&cs=tinysrgb&w=1260&h=750&dpr=1" alt="ممر في مكتبة عامرة بالكتب"></div>
                            <div class="swiper-slide"><img src="https://images.pexels.com/photos/590022/pexels-photo-590022.jpeg?auto=compress&cs=tinysrgb&w=1260&h=750&dpr=1" alt="مكتب عمل مع لابتوب ورسوم بيانية"></div>
                            <div class="swiper-slide"><img src="https://images.pexels.com/photos/380769/pexels-photo-380769.jpeg?auto=compress&cs=tinysrgb&w=1260&h=750&dpr=1" alt="مكتب عصري وأنيق"></div>
                        </div>
                    </div>
                </div>
            </section>
        </div>

        <!-- Products Section -->
        <section id="products" class="py-20 page-content">
            <div class="container mx-auto px-6">
                <h3 class="text-4xl font-bold text-center mb-12">منتجاتنا المميزة</h3>
                <div id="products-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-10">
                    <p class="col-span-full text-center text-lg">جاري تحميل المنتجات...</p>
                </div>
                <div class="text-center mt-16">
                    <button data-page="home" class="back-to-home-btn btn-secondary font-bold py-3 px-8 rounded-lg text-lg">
                        العودة للصفحة الرئيسية
                    </button>
                </div>
            </div>
        </section>

        <!-- About Us Section -->
        <section id="about" class="py-20 bg-gray-900/30 page-content">
            <div class="container mx-auto px-6 text-center">
                <h3 class="text-4xl font-bold mb-6">عن متجر المعرفة للمنتجات الرقمية</h3>
                <p class="text-xl max-w-4xl mx-auto leading-relaxed">
                    نؤمن في "متجر المعرفة" بأن الفضول هو شرارة الإبداع. كل منتج في متجرنا مصمم ليكون أكثر من مجرد غرض، بل هو أداة لإثارة التساؤل، وتشجيع التعلم، والاحتفاء برحلة الاكتشاف الفكري. من الفن الذي يجسد الحكمة إلى الأدوات التي تنظم أفكارك، نحن هنا لنرافقك في مسيرتك نحو الارتقاء.
                </p>
                <div class="text-center mt-12">
                     <button data-page="home" class="back-to-home-btn btn-secondary font-bold py-3 px-8 rounded-lg text-lg">
                        العودة للصفحة الرئيسية
                    </button>
                </div>
            </div>
        </section>

        <!-- Contact Us Section -->
        <section id="contact" class="py-20 page-content">
            <div class="container mx-auto px-6">
                <h3 class="text-4xl font-bold text-center mb-12">تواصل معنا</h3>
                <p class="text-center text-lg text-gray-400 max-w-2xl mx-auto mb-12">
                    نسعد باستقبال استفساراتكم ومقترحاتكم. يمكنكم التواصل معنا عبر القنوات التالية:
                </p>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-8 max-w-5xl mx-auto">
                    <a href="https://wa.me/966560223241" target="_blank" class="contact-card p-8 rounded-lg text-center flex flex-col items-center">
                        <i data-lucide="smartphone" class="w-16 h-16 text-green-400 mb-4"></i>
                        <h4 class="text-2xl font-bold mt-2">واتساب</h4>
                        <p class="text-lg text-amber-400 mt-1" dir="ltr">+966 56 022 3241</p>
                    </a>
                    <a href="tel:+966502311308" class="contact-card p-8 rounded-lg text-center flex flex-col items-center">
                         <i data-lucide="phone" class="w-16 h-16 text-sky-400 mb-4"></i>
                        <h4 class="text-2xl font-bold mt-2">اتصال</h4>
                        <p class="text-lg text-amber-400 mt-1" dir="ltr">+966 50 231 1308</p>
                    </a>
                    <a href="mailto:maarifastore@gmail.com" class="contact-card p-8 rounded-lg text-center flex flex-col items-center">
                        <i data-lucide="mail" class="w-16 h-16 text-red-400 mb-4"></i>
                        <h4 class="text-2xl font-bold mt-2">البريد الإلكتروني</h4>
                        <p class="text-lg text-amber-400 mt-1 break-all">maarifastore@gmail.com</p>
                    </a>
                </div>
                <div class="text-center mt-16">
                    <button data-page="home" class="back-to-home-btn btn-secondary font-bold py-3 px-8 rounded-lg text-lg">
                        العودة للصفحة الرئيسية
                    </button>
                </div>
            </div>
        </section>
        
        <!-- Checkout Page -->
        <section id="checkout" class="py-20 page-content">
            <div class="container mx-auto px-6">
                <h3 class="text-4xl font-bold text-center mb-12">إتمام عملية الشراء</h3>
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-12">
                    <div class="lg:col-span-2 bg-gray-900/30 p-8 rounded-lg">
                        <h4 class="text-2xl font-bold mb-6">معلومات العميل</h4>
                        <form id="checkout-form">
                            <div class="mb-4">
                                <label for="customer-name" class="block mb-2">الاسم الكامل</label>
                                <input type="text" id="customer-name" class="w-full p-2 rounded bg-gray-800 border border-gray-700 focus:outline-none focus:ring-2 focus:ring-amber-400" required>
                            </div>
                            <div class="mb-4">
                                <label for="customer-phone" class="block mb-2">رقم الجوال</label>
                                <input type="tel" id="customer-phone" class="w-full p-2 rounded bg-gray-800 border border-gray-700 focus:outline-none focus:ring-2 focus:ring-amber-400" required>
                            </div>
                            <h4 class="text-2xl font-bold mt-8 mb-6">طرق الدفع</h4>
                             <div class="bg-gray-800 p-4 rounded-lg">
                                 <p class="text-center text-gray-400 mb-4">اختر طريقة الدفع المفضلة لديك</p>
                                 <div class="flex justify-center items-center space-x-4 space-x-reverse">
                                     <img src="https://upload.wikimedia.org/wikipedia/commons/f/f2/Mada_logo.svg" alt="Mada" class="h-8 bg-white p-1 rounded">
                                     <img src="https://upload.wikimedia.org/wikipedia/commons/5/5e/Visa_Inc._logo.svg" alt="Visa" class="h-8">
                                     <img src="https://upload.wikimedia.org/wikipedia/commons/a/a4/Mastercard_2019_logo.svg" alt="Mastercard" class="h-8">
                                     <img src="https://upload.wikimedia.org/wikipedia/commons/f/fa/Apple_Pay_logo.svg" alt="Apple Pay" class="h-10">
                                 </div>
                             </div>
                        </form>
                    </div>
                    <div class="bg-gray-900/30 p-8 rounded-lg">
                        <h4 class="text-2xl font-bold mb-6">ملخص الطلب</h4>
                        <div id="checkout-summary" class="space-y-3 mb-6"></div>
                        <div class="border-t border-gray-700 pt-4 space-y-2">
                            <div class="flex justify-between">
                                <span>المجموع الفرعي</span>
                                <span id="checkout-subtotal">0 ر.س</span>
                            </div>
                            <div class="flex justify-between font-bold text-xl">
                                <span>الإجمالي</span>
                                <span id="checkout-total">0 ر.س</span>
                            </div>
                        </div>
                        <button type="submit" form="checkout-form" class="w-full btn-primary font-bold py-3 px-8 rounded-lg text-lg mt-6">تأكيد الطلب</button>
                        <button data-page="products" class="back-to-products-btn w-full text-center mt-4 text-gray-400 hover:text-white">
                            العودة للمنتجات
                        </button>
                    </div>
                </div>
            </div>
        </section>

    </main>

    <!-- Cart Modal -->
    <div id="cart-modal" class="modal">
        <div class="modal-content">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-3xl font-bold">سلة المشتريات</h3>
                <button id="close-cart-button" class="text-3xl font-bold hover:text-red-500">&times;</button>
            </div>
            <div id="cart-items-container" class="space-y-4 mb-6 max-h-64 overflow-y-auto"></div>
            <div class="border-t border-gray-600 pt-4">
                <div class="flex justify-between items-center text-xl font-bold">
                    <span>الإجمالي:</span>
                    <span id="cart-total">0 ر.س</span>
                </div>
                <button id="checkout-button" class="w-full btn-primary font-bold py-3 px-8 rounded-lg text-lg mt-6">إتمام الشراء</button>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="bg-gray-900 text-white">
        <div class="container mx-auto px-6 py-8">
            <div class="flex flex-col md:flex-row justify-between items-center">
                <div class="mb-6 md:mb-0">
                    <h2 class="text-2xl font-bold flex items-center">
                        <i data-lucide="lightbulb" class="ml-2 text-amber-400"></i>
                        <div>
                            <span class="text-amber-400">متجر</span> المعرفة
                            <span class="block text-xs font-normal text-gray-400">للمنتجات الرقمية</span>
                        </div>
                    </h2>
                    <p class="text-gray-400 mt-2">أدواتك للإلهام والنمو.</p>
                </div>
                <div class="flex space-x-4 space-x-reverse">
                    <a href="#" class="text-gray-400 hover:text-white"><i data-lucide="facebook" class="h-7 w-7"></i></a>
                    <a href="#" class="text-gray-400 hover:text-white"><i data-lucide="twitter" class="h-7 w-7"></i></a>
                    <a href="#" class="text-gray-400 hover:text-white"><i data-lucide="instagram" class="h-7 w-7"></i></a>
                </div>
            </div>
            <div class="mt-8 border-t border-gray-700 pt-6 text-center text-gray-500">
                <p>&copy; 2025 متجر المعرفة للمنتجات الرقمية. كل الحقوق محفوظة.</p>
            </div>
        </div>
    </footer>

    <!-- Swiper's JS -->
    <script src="https://unpkg.com/swiper/swiper-bundle.min.js"></script>
    
    <!-- Firebase SDKs (Compatibility version) -->
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script>

    <!-- Your App's Logic -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            
           
            const firebaseConfig = {
  apiKey: "AIzaSyAKluQllyvfcH7j5UCOQFDDMaUBWOV9yW8",
  authDomain: "maarifa-store.firebaseapp.com",
  projectId: "maarifa-store",
  storageBucket: "maarifa-store.firebasestorage.app",
  messagingSenderId: "940520390427",
  appId: "1:940520390427:web:1aaaea5c259bdd94de9dbe",
  measurementId: "G-QRLNHK0DXK"
};
           

            // Check for placeholder API Key
            if (firebaseConfig.apiKey === "YOUR_API_KEY") {
                document.body.innerHTML = `<div class="h-screen w-screen bg-gray-900 flex items-center justify-center text-white text-center p-8" dir="rtl"><div><h1 class="text-3xl font-bold text-red-500 mb-4">خطأ في الإعدادات</h1><p class="text-xl mb-2">المتجر لا يعمل لأن مفتاح Firebase API غير صحيح.</p><p class="mt-4 text-gray-400">يرجى لصق مفاتيح <code class="bg-gray-700 p-1 rounded">firebaseConfig</code> الخاصة بك في ملف HTML.</p></div></div>`;
                return;
            }

            // Initialize Firebase
            const app = firebase.initializeApp(firebaseConfig);
            const db = firebase.firestore();
            const auth = firebase.auth();

            // --- DOM Elements ---
            const productsGrid = document.getElementById('products-grid');
            const cartButton = document.getElementById('cart-button');
            const cartModal = document.getElementById('cart-modal');
            const closeCartButton = document.getElementById('close-cart-button');
            const cartItemsContainer = document.getElementById('cart-items-container');
            const cartTotalEl = document.getElementById('cart-total');
            const cartCounter = document.getElementById('cart-counter');
            const checkoutButton = document.getElementById('checkout-button');
            const mobileMenuButton = document.getElementById('mobile-menu-button');
            const mobileMenu = document.getElementById('mobile-menu');

            let cart = JSON.parse(localStorage.getItem('knowledgeStoreCart')) || [];

            // --- Page Navigation ---
            function showPage(pageId) {
                if (!pageId) return;
                document.querySelectorAll('.page-content').forEach(page => page.style.display = 'none');
                const selectedPage = document.getElementById(pageId);
                if (selectedPage) {
                    selectedPage.style.display = 'block';
                }
                document.querySelectorAll('.nav-link').forEach(link => {
                    link.classList.toggle('active', link.dataset.page === pageId);
                });
            }

            // --- Cart Logic ---
            function updateCartUI() {
                cartItemsContainer.innerHTML = '';
                let total = 0;
                if (cart.length === 0) {
                    cartItemsContainer.innerHTML = '<p class="text-center text-gray-400">سلتك فارغة.</p>';
                } else {
                    cart.forEach(item => {
                        total += item.price * item.quantity;
                        const itemElement = document.createElement('div');
                        itemElement.className = 'cart-item flex justify-between items-center py-2 border-b border-gray-700';
                        itemElement.innerHTML = `<div class="flex items-center"><img src="${item.image}" alt="${item.name}" class="w-12 h-12 object-cover rounded-md"><div class="mr-4"><h4 class="font-bold">${item.name}</h4><p class="text-sm text-gray-400">${item.price} ر.س</p></div></div><div class="flex items-center"><span class="ml-4">x ${item.quantity}</span><button class="text-red-500 hover:text-red-700 text-2xl remove-from-cart" data-id="${item.id}">&times;</button></div>`;
                        cartItemsContainer.appendChild(itemElement);
                    });
                }
                cartTotalEl.textContent = `${total.toFixed(2)} ر.س`;
                const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
                cartCounter.textContent = totalItems;
                cartCounter.style.display = totalItems > 0 ? 'flex' : 'none';
            }

            function addToCart(product) {
                const existingItem = cart.find(item => item.id === product.id);
                if (existingItem) {
                    existingItem.quantity++;
                } else {
                    cart.push({ ...product, quantity: 1 });
                }
                localStorage.setItem('knowledgeStoreCart', JSON.stringify(cart));
                updateCartUI();
            }

            function removeFromCart(productId) {
                cart = cart.filter(item => item.id !== productId);
                localStorage.setItem('knowledgeStoreCart', JSON.stringify(cart));
                updateCartUI();
            }

            // --- Firestore Data ---
            function renderStoreProducts() {
                // ** CORRECTED to use your 'products' collection **
                const productsCollectionPath = "products"; 
                db.collection(productsCollectionPath).onSnapshot(
                    (querySnapshot) => {
                        productsGrid.innerHTML = '';
                        if (querySnapshot.empty) {
                            productsGrid.innerHTML = '<p class="col-span-full text-center text-lg">لا توجد منتجات لعرضها حالياً. اذهب إلى قاعدة بيانات Firestore وأضف منتجات في مجموعة "products".</p>';
                            return;
                        }
                        querySnapshot.forEach((doc) => {
                            const product = { id: doc.id, ...doc.data() };
                            const productCard = document.createElement('div');
                            productCard.className = 'card rounded-lg overflow-hidden shadow-lg flex flex-col';
                            productCard.innerHTML = `<img src="${product.image}" alt="${product.name}" class="w-full h-64 object-cover" onerror="this.onerror=null;this.src='https://placehold.co/600x400/1a2942/fbbf24?text=Image+Not+Found';"><div class="p-6 flex flex-col flex-grow"><h4 class="text-2xl font-bold mb-2 flex-grow">${product.name}</h4><p class="mb-4 text-gray-400">${product.description}</p><div class="flex justify-between items-center mt-auto"><span class="text-2xl font-bold text-amber-400">${product.price} ر.س</span><button class="btn-secondary font-bold py-2 px-4 rounded-lg add-to-cart-btn">أضف للسلة</button></div></div>`;
                            productCard.querySelector('.add-to-cart-btn').addEventListener('click', () => addToCart(product));
                            productsGrid.appendChild(productCard);
                        });
                    },
                    (error) => {
                        console.error("Error fetching products: ", error);
                        productsGrid.innerHTML = `<p class="col-span-full text-center text-lg text-red-500">حدث خطأ أثناء تحميل المنتجات. تأكد من صحة إعدادات Firebase وأن قواعد الأمان تسمح بالقراءة.</p>`;
                    }
                );
            }

            // --- Event Listeners and Initializers ---
            lucide.createIcons();

            try {
                new Swiper('.swiper-container', { loop: true, autoplay: { delay: 3000, disableOnInteraction: false }, effect: 'fade', fadeEffect: { crossFade: true } });
            } catch (e) {
                console.error("Swiper initialization failed:", e);
            }

            mobileMenuButton.addEventListener('click', () => {
                mobileMenu.classList.toggle('hidden');
                const icon = mobileMenuButton.querySelector('i');
                icon.setAttribute('data-lucide', mobileMenu.classList.contains('hidden') ? 'menu' : 'x');
                lucide.createIcons();
            });

            document.querySelectorAll('[data-page]').forEach(element => {
                element.addEventListener('click', (e) => {
                    e.preventDefault();
                    showPage(element.dataset.page);
                    if (element.classList.contains('nav-link-mobile')) {
                        mobileMenu.classList.add('hidden');
                        mobileMenuButton.querySelector('i').setAttribute('data-lucide', 'menu');
                        lucide.createIcons();
                    }
                });
            });
            
            cartButton.addEventListener('click', () => cartModal.style.display = 'block');
            closeCartButton.addEventListener('click', () => cartModal.style.display = 'none');
            window.addEventListener('click', (event) => {
                if (event.target == cartModal) cartModal.style.display = 'none';
            });
            cartItemsContainer.addEventListener('click', (e) => {
                const removeButton = e.target.closest('.remove-from-cart');
                if (removeButton) removeFromCart(removeButton.dataset.id);
            });
            checkoutButton.addEventListener('click', () => {
                if (cart.length > 0) {
                    cartModal.style.display = 'none';
                    showPage('checkout');
                }
            });

            updateCartUI();

            // --- Firebase Authentication and Data Loading ---
            async function startFirebase() {
                try {
                    await auth.signInAnonymously();
                    if (auth.currentUser) {
                        console.log("User is authenticated anonymously:", auth.currentUser.uid);
                        renderStoreProducts();
                    }
                } catch (error) {
                    console.error("Firebase Anonymous Auth failed:", error);
                    productsGrid.innerHTML = `<p class="col-span-full text-center text-lg text-red-500">فشل تسجيل الدخول. تأكد من تفعيل Anonymous Authentication في مشروع Firebase.</p>`;
                }
            }
            
            startFirebase();
        });
    </script>

</body>
</html>
